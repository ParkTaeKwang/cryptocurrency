
<!DOCTYPE html><html lang="ko"><head><title>Block</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"><link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous"><link rel="stylesheet" href="/stylesheets/style.css"><script src="//code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="//cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script><script src="//cdn.jsdelivr.net/npm/vue"></script><script>var web3;
if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}
</script></head><body><nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top"><a href="/" class="navbar-brand text-uppercase">Ether Expolorer</a><button type="button" data-toggle="collapse" data-target="#navbarsDefault" aria-controls="navbarsDefault" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"> <span class="navbar-toggler-icon"></span></button><div id="navbarsDefault" class="collapse navbar-collapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a href="/" class="nav-link">Home<span class="sr-only">(current)</span></a></li><li class="nav-item"><a href="/watch" class="nav-link">Watch</a></li></ul><form id="searchForm" class="form-inline my-2 my-lg-0"><input type="search" name="search" size="50" placeholder="Search for Account, Tx Hash or Data" aria-label="Search" required autofocus class="form-control mr-sm-2"><button type="submit" class="btn btn-outline-success my-2 my-sm-0">Search</button></form></div></nav><main role="main" class="container"><h1>Block<span class="text-muted ml-2">#5101837</span></h1><div id="app" v-cloak><table class="table table-striped"><tr><td class="w-25">Height</td><td>{{ block.number }}</td></tr><tr><td>TimeStamp</td><td>{{ new Date(block.timestamp * 1000).toGMTString() }}</td></tr><tr><td>Transactions</td><td>{{ block.transactions.length }} transactions</td></tr><tr><td>Hash</td><td>{{ (block.hash || 'pending') }}</td></tr><tr><td>Parent Hash</td><td>{{ block.parentHash }}</td></tr><tr><td>Sha3Uncles</td><td>{{ block.sha3Uncles }}</td></tr><tr><td>Mined By</td><td><span v-if="block.miner === undefined">pending</span><a v-if="block.miner !== undefined" v-bind:href="'/address/' +  block.miner">{{  block.miner }}</a></td></tr><tr><td>Difficulty</td><td>{{ block.difficulty }}</td></tr><tr><td>Total Difficulty</td><td>{{ block.totalDifficulty }}</td></tr><tr><td>Size</td><td>{{ block.size }} bytes</td></tr><tr><td>Gas Used</td><td>{{ block.gasUsed }}</td></tr><tr><td>Gas Limit</td><td>{{ block.gasLimit }}</td></tr><tr><td>Nonce</td><td>{{ block.nonce }}</td></tr><tr><td>Extra Data</td><td>{{ block.extraData }}</td></tr><tr><td>Extra Data (Translated)</td><td>{{ web3.toAscii(block.extraData) }}</td></tr><tr><td>logsBloom</td><td><textarea disabled readonly rows="3">{{ block.logsBloom }}</textarea></td></tr><tr><td>mixHash</td><td>{{ block.mixHash }}</td></tr><tr><td>receiptsRoot</td><td>{{ block.receiptsRoot }}</td></tr><tr><td>stateRoot</td><td>{{ block.stateRoot }}</td></tr><tr><td>transactionsRoot</td><td>{{ block.transactionsRoot }}</td></tr><tr><td>uncles</td><td>{{ block.uncles }}</td></tr></table><h2>Transactions</h2><table class="table table-striped w-100"><tr> <th>Transaction Hash</th></tr><tr v-for="tx in block.transactions" v-if="block.transactions"><td><a v-bind:href="'/tx/' +tx">{{ tx }}</a></td></tr></table></div><script>var app = new Vue({
  el: '#app',
  data: {
    number:  5101837,
    confirmations: null,
    block: {
      number:null,
      timestamp:null,
      transactions: [],
      extraData: "",
      size: 0
    }
  },
  created: function() {
    getBlockInfo(this.number);
  }
});

function getBlockNumber() {
  return new Promise((res, rej) => {
    web3.eth.getBlockNumber((error, result) => {
      if(error) rej(error);
      else res(result);
    });
  });
}

function getBlock(hashStringOrBlockNumber) {
  return new Promise((res, rej) => {
    web3.eth.getBlock(hashStringOrBlockNumber, (error, result) => {
      if(error) rej(error);
      else res(result);
    });
  });
}

function getBlockTransactionCount(hashStringOrBlockNumber) {
  return new Promise((res, rej) => {
    web3.eth.getBlockTransactionCount(hashStringOrBlockNumber, (error, result) => {
      if(error) rej(error);
      else res(result);
    });
  });
}

async function getBlockInfo(number) {

  var latestBlockNumber = await getBlockNumber();

  var block = await getBlock(number); //or "latest"
  block.difficulty = block.difficulty.toString(10);
  block.totalDifficulty = block.totalDifficulty.toString(10);
  app.block  = block; 

  var blockNumber  = block.number;
  var confirm;
  if( blockNumber ) {
    var latestBlockNumber = await getBlockNumber();
    if( blockNumber !== 0 && blockNumber !== latestBlockNumber ) 
      confirm = (latestBlockNumber - blockNumber) + " Confirmations";
  }
  app.confirmations = confirm || 'Unconfirmed';

  //- var blockTransactionCount = await getBlockTransactionCount(result.number);
  //- console.log('blockTransactionCount: ', blockTransactionCount);

  // web3.eth.getTransactionFromBlock(hashStringOrBlockNumber [, callback])
  // web3.eth.getUncle(blockHashStringOrNumber, uncleNumber [, returnTransactionObjects] [, callback])

}</script></main><script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="//stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script><script>$("#navbarsDefault a").each(function(i, e){
  if( location.href == e.href ) {
    e.closest("li.nav-item").classList.add("active");
  }
});

// search form
$('#searchForm').submit(function(evt) {
  evt.preventDefault();
  var search = evt.target.search.value;
  //- console.log(search, ", ", search.length);

  //- search = search.split('0x').join('');
  //- var regexpTx = /[0-9a-zA-Z]{64}?/;
  //- //var regexpAddr =  /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/; // TODO ADDR REGEX or use isAddress(hexString) API ?
  //- var regexpAddr = /^(0x)?[0-9a-f]{40}$/; //New ETH Regular Expression for Addresses
  //- var regexpBlock = /[0-9]{1,7}?/;
  //- var result =regexpTx.test(search);

  if( search.length === 66 ) { //tx hash
    location.href = '/tx/' + search;
  } else if( search.length === 42 && web3.isAddress(search) ) {
    location.href = '/address/' + search;
  } else if( search <= blockNumber ) {
    location.href = '/block/' + search;
  } else {
    console.log('what?');
  }      
  
});</script></body></html>
